# 1942

## Game Type
Vertical scrolling shooter

## Core Mechanics
- **Goal**: Survive wave-based enemy attacks and achieve the highest score. A boss spawns at score thresholds.
- **Movement**: Player aircraft moves freely in all four directions within the bottom ~70% of the screen.
- **Key interactions**: Auto-fire by holding Space, dodge roll on Shift or double-tap Space, collect power-ups dropped by enemies.

## Controls
- Arrow keys: move player
- Space (hold): fire bullets
- Space (double-tap) or Shift: barrel roll (invincibility frames, 40-frame duration, 90-frame cooldown)

## Difficulty Progression

### Structure
The game is wave-based. When all enemies in a wave are destroyed, a 60-frame pause triggers, then the next wave spawns. `waveNumber` increments each wave. Waves cycle through 5 formations: v, line, stagger, circle, diagonal. A boss spawns whenever `score >= bossSpawnScore` (starting at 300), then the threshold rises by `400 + waveNumber * 50`.

### Key Difficulty Variables
- `waveNumber`: starts at 0, increments every wave (no cap on scaling). Used in nearly all difficulty formulas.
- `count` (enemies per wave): starts at `4 + Math.min(Math.floor(diff / 2), 6)`, so waves 1-2 spawn 4 enemies, caps at 10 enemies by wave 12.
- `baseSpeed` (enemy movement speed): `1.5 + diff * 0.1` where `diff = Math.min(waveNumber, 20)`. Starts at ~1.6 px/frame, reaches ~3.5 at wave 20.
- `fireRate` (enemy fire interval, in frames): `Math.max(40, 150 - diff * 8)`. Starts at 142 frames (~2.4s), reaches minimum 40 frames (~0.67s) by wave ~14.
- Enemy types unlocked: fighters from wave 1, bombers from wave 3 (`diff >= 3`), aces from wave 6 (`diff >= 6`).
- Boss HP: `25 + waveNumber * 5`. First boss spawns at score 300 and has at least 30 HP.
- `ENEMY_BULLET_SPEED`: base 3, increases by `waveNumber * 0.05` per bullet (non-boss enemies) and `waveNumber * 0.1` for boss spread shots.
- `bossSpawnScore`: starts at 300, increases by `400 + waveNumber * 50` after each boss.
- Power-up drop chance: 15% per enemy death (fixed).
- Power-up durations: `doubleShot` lasts 600 frames (~10s), `speedBoost` lasts 480 frames (~8s).

### Difficulty Curve Assessment
The first boss arrives extremely early — at only 300 points, which is just 30 fighter kills. A new player will likely face the boss within the first 2-3 waves before they understand the controls. Enemy fire rate also ramps aggressively, halving from wave 1 to wave 14, making mid-game feel punishing.

## Suggested Improvements
- [ ] Increase `bossSpawnScore` from 300 to 800 to give players 4-6 waves of normal enemies before the first boss encounter.
- [ ] Raise initial `baseSpeed` formula from `1.5 + diff * 0.1` to a softer start: `1.2 + diff * 0.08`, so wave 1 enemies move at 1.28 instead of 1.6.
- [ ] Raise minimum enemy fire rate cap from 40 frames to 60 frames, reducing late-game bullet density.
- [ ] Increase power-up drop chance from 15% to 20% for the first 5 waves to help new players survive early.
- [ ] Delay bomber and ace introduction: unlock bombers at `diff >= 5` and aces at `diff >= 9` (currently 3 and 6 respectively).
- [ ] Add a short (2s) invincibility window after losing a life instead of only providing invincibility during a roll.

---

## Campaign Level Design

The game currently has unlimited procedural waves with no sense of place or progression. The following describes a 6-mission campaign where each mission has a distinct visual biome, enemy roster, and boss. Waves within each mission cycle through the mission's enemy set; the mission ends when the boss is defeated.

---

### Mission 1 — "Open Pacific" (Waves 1–6)
**Setting**: Deep blue open ocean, no land. Bright midday light reflecting off choppy swells.
**Background**: Scrolling dark navy water with white foam crests. Distant horizon haze. No islands visible.
**Enemy roster**:
- Mitsubishi Zero fighters (red roundels, tight v-formations of 5)
- No bombers, no ships
**Boss — "Admiral's Escort"**: A single large Zero with a red stripe, 3 escort wingmen. Wingmen respawn once. HP: 40.
**Atmosphere**: Clean, introductory. Player learns basic dodge and shoot. No ships yet.
**Palette**: `#0a1a3a` sky, `#0d3b6e` ocean, `#c8e0f4` foam highlights, enemy red `#cc2200`.

---

### Mission 2 — "Island Chain" (Waves 7–14)
**Setting**: Volcanic island chain. Green jungle islands with sandy beaches passing below. Some are on fire from prior battles.
**Background**: Ocean with scattered islands scrolling past — jungle green blobs with beach tan margins. Palm tree silhouettes. Smoke rising from some.
**Enemy roster**:
- Zeros (faster, looser formations)
- Aichi dive bombers (larger, slower, shoot spread patterns)
- Surface ship: Destroyer — fixed horizontal position, fires flak bursts upward every 90 frames
**Boss — "Ironclad"**: A heavy destroyer with two forward turrets and a rear AA gun. Three attack phases: stationary firing, slow forward advance, final desperate broadside. HP: 70.
**New mechanic**: Ships cannot be killed by regular bullets — only bombs (player holds Space 0.5s to drop one, limited to 3). Dropping a bomb on the destroyer turret silences it for 5 seconds.
**Palette**: `#1a3a1a` jungle, `#c8a060` sand, `#3a6aaa` ocean, smoke `#606060`.

---

### Mission 3 — "Coral Sea" (Waves 15–22)
**Setting**: Shallow reef waters at dusk. Turquoise shallows transition to deep blue. Enemy aircraft carrier visible in the background.
**Background**: Coral reef patterns visible through shallow water — cyan and teal with sandy patches. Orange dusk sky gradient at top of screen. Aircraft carrier silhouette scrolling slowly across mid-screen (untargetable, just atmosphere).
**Enemy roster**:
- Zeros (aggressive dive patterns — they curve toward player)
- Kawanishi flying boats (large, slow, drop torpedo-like projectiles that fall diagonally)
- Two destroyers flanking center
**Boss — "The Carrier"**: The carrier becomes targetable. Four AA turrets must be destroyed in sequence before the bridge (HP pool) is exposed. Each turret has HP 20, bridge HP 60. Turrets fire in coordinated patterns.
**Palette**: `#0a4a5a` reef water, `#40a0b0` shallows, `#ff8030` dusk sky, carrier `#505050`.

---

### Mission 4 — "Monsoon Run" (Waves 23–30)
**Setting**: Storm over open ocean. Heavy rain, lightning flashes. Visibility poor.
**Background**: Dark stormcloud layers in deep grey and purple. Rain streaks falling. Periodic full-screen lightning flash (white overlay, alpha 0.15, lasts 3 frames). Whitecap waves below, barely visible.
**Enemy roster**:
- Night fighters (dark grey Zero variants, harder to see against background)
- Torpedo bombers flying low in pairs — sweep across screen horizontally instead of diving
- Submarine: surfaces briefly every 30 seconds, fires 3 flak rounds, then submerges (only vulnerable while surfaced)
**New mechanic**: Lightning flash briefly silhouettes all enemies (makes them easier to shoot) but also blinds the player's bullet trail for 3 frames.
**Boss — "Typhoon Ace"**: A black-painted ace in a modified Zero. Extremely fast, barrel rolls to dodge bullets (50% bullet deflection). Phase 2: calls in two escort wingmen that mirror his movements symmetrically. HP: 50 (escorted phase adds 30 more).
**Palette**: `#1a1a2a` storm sky, `#303060` clouds, `#606080` rain, lightning `#fffff0`, enemy `#404040`.

---

### Mission 5 — "Volcano Straits" (Waves 31–38)
**Setting**: Active volcanic islands at night. Lava flows visible on island flanks. Sky lit orange from eruptions. Ash particles drift upward (reverse parallax).
**Background**: Black ocean with orange-lit undersides of clouds. Islands with glowing red lava streams. Ash particles drift upward on screen (reverse scroll). Occasional falling volcanic rock (terrain hazard — dodge or die instantly).
**Enemy roster**:
- Ace fighters (individual, irregular movement patterns)
- Heavy bombers (3 engines, slow, very high HP 15, drop clusters of 4 bombs simultaneously)
- Shore battery: fixed cannon on island, fires every 60 frames. Cannot be destroyed without bombs.
**New mechanic**: Volcanic rocks fall from top of screen (2 per wave, random X, predictable speed). They destroy enemies too if collision occurs.
**Boss — "The Volcano King"**: A massive four-engine bomber with fighter escort. Does not shoot itself — but its escort of 4 Zeros in tight formation does. Destroying each Zero reveals the bomber's engine pods (each pod takes 10 HP). Destroying all 4 pods reveals the cockpit (final 30 HP). Full sequence HP: 4×10 + 30 = 70.
**Palette**: `#0a0a0a` night sky, `#ff4400` lava, `#cc6600` island lit sides, `#ff8800` cloud undersides, ash `#888888`.

---

### Mission 6 — "Tokyo Bay" (Waves 39–50+)
**Setting**: Enemy home waters. Industrial docks, battleships, floating fortresses. Dawn light breaking.
**Background**: Grey industrial docks and warehouses along the left and right edges of screen. Multiple warships visible at once — battleships, cruisers, destroyers, all scrolling at different parallax speeds. Dawn sky gradient: dark blue → pale pink → warm orange.
**Enemy roster**:
- Elite Zeros (full AI behavior: dive, split, converge)
- Kamikaze variants: charge directly at player without firing, must be shot or rolled through
- Battleship with 3 turrets: fires heavy shells (2×2 pixel slow projectiles, high damage) in timed salvos
- Floating AA platform (stationary, rapid fire, must be bombed to destroy)
**New mechanic**: Mission 6 has no defined ending — waves escalate indefinitely. Every 5th wave is a boss encounter cycling through upgraded versions of all previous bosses.
**Final Boss — "Yamato"**: A massive battleship spanning the full width of the screen. Appears in three scroll passes:
- Pass 1: player flies over the bow — two forward turrets fire alternating salvos
- Pass 2: amidships — AA batteries fire 360° patterns upward
- Pass 3: stern — rear turret fires tracking shots, propeller wash creates turbulence (random drift applied to player movement ±1px/frame for 5 seconds)
- Bridge (final): centered, tiny hitbox, 80 HP. Appears only after all three turret batteries are silenced.
**Palette**: `#1a2a3a` predawn ocean, `#ff9966` dawn sky, `#505050` battleship hull, `#cc8800` gun flash, `#ff2200` explosion.

---

## Implementation Notes

Each mission requires:
1. A `mission` variable (1–6) that gates which enemy types spawn
2. A `bgTheme` variable passed to the background renderer
3. Boss detection: boss spawns when `wavesInMission >= missionWaveCount` instead of score threshold
4. Ship/destroyer/carrier objects drawn in a new layer between background and aircraft
5. Bombs: player secondary weapon (hold Space 0.5s), 3 max, replenish on power-up pickup
