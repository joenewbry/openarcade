<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game Builder — OpenArcade</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='12' fill='%238b5cf6'/><text x='50' y='70' font-size='55' font-family='Arial,sans-serif' font-weight='bold' fill='white' text-anchor='middle'>G</text></svg>">
  <link rel="stylesheet" href="builder.css">
</head>
<body>

<!-- ── Space background canvas ─────────────────────────────── -->
<canvas id="gbSpaceCanvas" class="gb-space-canvas"></canvas>

<!-- ── Confetti cursor canvas ──────────────────────────────── -->
<canvas id="gbConfettiCanvas" class="gb-confetti-canvas"></canvas>

<!-- ── Header ─────────────────────────────────────────────── -->
<header class="gb-header">
  <a href="/" class="gb-logo">ARCADE</a>
  <span class="gb-breadcrumb">/ Game Builder</span>

  <div class="gb-phase-indicator" title="Pick Type → Pick Mode → Design → Generating → Playing">
    <div class="gb-phase-dot active" title="Pick Type"></div>
    <div class="gb-phase-dot" title="Pick Mode"></div>
    <div class="gb-phase-dot" title="Design"></div>
    <div class="gb-phase-dot" title="Generating"></div>
    <div class="gb-phase-dot" title="Playing"></div>
  </div>

  <a href="/pipeline/" class="gb-lib-link" target="_blank">Pipeline ↗</a>
  <a href="/how-it-works/" class="gb-lib-link" target="_blank">How It's Made ↗</a>
</header>

<!-- ── Global Progress Bar ────────────────────────────────── -->
<div class="gb-global-progress">
  <div class="gb-global-progress-fill" id="gbGlobalProgressFill"></div>
  <div class="gb-global-progress-ticks">
    <div class="gb-tick" style="left:25%"></div>
    <div class="gb-tick" style="left:50%"></div>
    <div class="gb-tick" style="left:75%"></div>
  </div>
  <div class="gb-global-progress-label" id="gbGlobalProgressLabel">0%</div>
</div>

<!-- ── Session Dashboard (no ?id=) ────────────────────────── -->
<div class="gb-dashboard" id="gbDashboard" style="display:none">
  <div class="gb-dashboard-header">
    <h2>Your Game Sessions</h2>
    <button class="gb-new-game-btn" id="gbNewGameBtn">+ New Game</button>
  </div>
  <div class="gb-dashboard-grid" id="gbDashboardGrid">
    <div class="gb-dashboard-loading">Loading sessions...</div>
  </div>
</div>

<!-- ── PICK_TYPE overlay ──────────────────────────────────── -->
<div class="gb-pick-type" id="gbPickType" style="display:none">
  <div class="gb-pick-type-header">
    <h2>What kind of game?</h2>
    <p>Choose your starting archetype — this sets up the right agents and tools</p>
  </div>
  <div class="gb-pick-type-grid" id="gbPickTypeGrid">
    <!-- Rendered by builder.js from /api/archetypes -->
  </div>
</div>

<!-- ── PICK_MODE overlay ─────────────────────────────────── -->
<div class="gb-pick-mode" id="gbPickMode" style="display:none">
  <div class="gb-pick-mode-header">
    <h2>How many players?</h2>
    <p>This affects networking, state sync, and matchmaking agents</p>
  </div>
  <div class="gb-pick-mode-cards">
    <div class="gb-mode-card" data-mode="single">
      <div class="gb-mode-icon">1P</div>
      <div class="gb-mode-label">Single Player</div>
      <div class="gb-mode-desc">Classic solo experience — AI opponents, local high scores</div>
    </div>
    <div class="gb-mode-card" data-mode="multiplayer">
      <div class="gb-mode-icon">2P+</div>
      <div class="gb-mode-label">Multiplayer</div>
      <div class="gb-mode-desc">Real-time online play with server networking and matchmaking</div>
    </div>
  </div>
</div>

<!-- ── Main ───────────────────────────────────────────────── -->
<main class="gb-main" id="gbMain">

  <!-- ── Chat sidebar ──────────────────────────────────────── -->
  <aside class="gb-chat">

    <!-- Design checklist -->
    <div class="gb-checklist">
      <div class="gb-checklist-title">Design Progress</div>
      <div class="gb-design-progress">
        <div class="gb-design-progress-fill" id="gbDesignProgress"></div>
      </div>
      <div class="gb-checks" id="gbChecks">
        <!-- Rendered by builder.js -->
      </div>
    </div>

    <!-- Messages -->
    <div class="gb-messages" id="gbMessages"></div>

    <!-- Agent bar -->
    <div class="gb-agent-bar" id="gbAgentBar">
      <!-- Rendered by builder.js — colored chips for active agents -->
    </div>

    <!-- Generate button (shown when ready) -->
    <button class="gb-generate-btn" id="gbGenerateBtn"></button>

    <!-- Input -->
    <div class="gb-input-row" id="gbInputRow">
      <textarea
        class="gb-input"
        id="gbInput"
        placeholder="Describe your game idea…"
        rows="1"
        maxlength="2000"
        autocomplete="off"
        spellcheck="false"
      ></textarea>
      <button class="gb-send" id="gbSend">Send ▶</button>
    </div>

  </aside>

  <!-- ── Right panel ───────────────────────────────────────── -->
  <section class="gb-right">

    <!-- Concept panel (DESIGN phase — concept art + level options) -->
    <div class="gb-concept-panel" id="gbConceptPanel">
      <div class="gb-concept-title">CONCEPT PREVIEW</div>
      <div class="gb-concept-image" id="gbConceptImage">
        <div class="gb-concept-placeholder">Concept art generates as your design takes shape...</div>
      </div>
      <div class="gb-level-options" id="gbLevelOptions" style="display:none">
        <!-- 2x2 grid of level design option thumbnails -->
      </div>
    </div>

    <!-- Generation progress panel (GENERATING phase) -->
    <div class="gb-progress-panel" id="gbProgressPanel">
      <div class="gb-progress-title">Building Your Game</div>

      <div id="gbProgressPct" class="gb-progress-pct">0%</div>

      <div class="gb-progress-bar-wrap">
        <div class="gb-progress-bar" id="gbProgressBar"></div>
      </div>

      <div id="gbProgressStep" class="gb-progress-step">Initializing…</div>

      <!-- Build Checklist (from game.md sections) -->
      <div class="gb-build-checklist" id="gbBuildChecklist">
        <!-- Rendered by builder.js during GENERATING -->
      </div>

      <!-- Agent Grid (parallel mode) -->
      <div class="gb-agent-grid" id="gbAgentGrid">
        <div class="gb-agent-tier" data-tier="0">
          <div class="gb-agent-tier-label">TIER 0: PLANNING</div>
          <div class="gb-agent-tier-agents" id="gbTier0Agents"></div>
        </div>
        <div class="gb-agent-tier" data-tier="1">
          <div class="gb-agent-tier-label">TIER 1: DEPARTMENTS (parallel)</div>
          <div class="gb-agent-tier-agents" id="gbTier1Agents"></div>
        </div>
        <div class="gb-agent-tier" data-tier="2">
          <div class="gb-agent-tier-label">TIER 2: INTEGRATION</div>
          <div class="gb-agent-tier-agents" id="gbTier2Agents"></div>
        </div>
        <div class="gb-agent-tier" data-tier="3">
          <div class="gb-agent-tier-label">TIER 3: QUALITY CHECK</div>
          <div class="gb-agent-tier-agents" id="gbTier3Agents"></div>
        </div>
      </div>

      <!-- Sequential step log (fallback) -->
      <div class="gb-step-log" id="gbStepLog"></div>

      <div class="gb-eta" id="gbEta"></div>

      <div class="gb-stack-info" id="gbStackInfo">
        <div>Resolving tech stack…</div>
      </div>

      <!-- QA Result overlay -->
      <div class="gb-qa-overlay" id="gbQaOverlay" style="display:none">
        <div class="gb-qa-title">Quality Check</div>
        <div class="gb-qa-checklist" id="gbQaChecklist"></div>
      </div>

      <div class="gb-console" id="gbConsole">
        <div class="gb-console-chrome">
          <span class="gb-dot red"></span>
          <span class="gb-dot yellow"></span>
          <span class="gb-dot green"></span>
          <span class="gb-console-title">build.log</span>
        </div>
        <div class="gb-console-body" id="gbConsoleBody"></div>
      </div>
    </div>

    <!-- Game panel (PLAYING phase) -->
    <div class="gb-game-panel" id="gbGamePanel">
      <div class="gb-game-toolbar">
        <span class="gb-game-title" id="gbGameTitle">—</span>
        <span class="gb-game-meta" id="gbGameMeta"></span>
        <div class="gb-toolbar-actions">
          <button class="gb-toolbar-btn" id="gbViewGameMd">game.md</button>
          <button class="gb-toolbar-btn" id="gbViewChatLog">chat log</button>
          <button class="gb-toolbar-btn" id="gbShareLink">share</button>
        </div>
      </div>
      <iframe class="gb-game-iframe" id="gbGameIframe" sandbox="allow-scripts allow-same-origin" title="Game Preview"></iframe>
    </div>

  </section>

</main>

<!-- ── Toast notifications ────────────────────────────────── -->
<div class="gb-toast-container" id="gbToastContainer"></div>

<script src="builder.js"></script>
</body>
</html>
