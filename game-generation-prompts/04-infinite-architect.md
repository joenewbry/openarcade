# Infinite Architect — Procedural City Builder with Economy Simulation

Build a **procedural isometric city builder** as a single `index.html` file with full economic simulation, citizen AI, weather, day/night cycles, and physics-based disasters.

## Core Requirements

### Isometric Rendering (Canvas 2D)
- Isometric tile-based map (at least 64x64 tiles)
- Smooth camera panning with WASD or click-drag
- Zoom in/out with scroll wheel (at least 3 zoom levels)
- Tile sorting for correct depth ordering (painter's algorithm)
- Each building type has a distinct isometric sprite drawn procedurally (no image files)
- Animated elements: smoke from factories, lights in windows at night, water flow
- Minimap in the corner showing the full map with building colors

### Terrain Generation
- Perlin noise for elevation (hills, valleys, flat plains)
- Water bodies (rivers, lakes) at low elevation
- Trees and rocks on undeveloped land
- Terrain affects building placement: can't build on water, hills cost more
- Resource deposits (ore, fertile soil) visible on the map, affect building efficiency

### Building Types (8+)
1. **House** — Provides housing for 4 citizens. Requires road access. Upgrades to Apartment (12 citizens) at population milestones.
2. **Farm** — Produces food. Output boosted on fertile soil. Affected by weather.
3. **Mine** — Produces ore/stone. Must be placed on resource deposits.
4. **Factory** — Converts ore → goods. Produces pollution. Requires workers.
5. **Market** — Sells food and goods to citizens, generating tax revenue. Needs road connection to production buildings.
6. **Power Plant** — Provides electricity in a radius. Buildings without power operate at 50%.
7. **School** — Increases citizen skill level in radius, boosting all building efficiency by 20%.
8. **Hospital** — Increases citizen health/happiness in radius. Reduces death rate.
9. **Road** — Connects buildings. Citizens pathfind along roads. Buildings without road access don't function.
10. **Park** — Boosts happiness in radius. No production.

### Production Chains
- Farm → Food → Market → Citizens (food)
- Mine → Ore → Factory → Goods → Market → Citizens (goods)
- Power Plant → Electricity → All buildings in radius
- Each chain link requires road connectivity
- Supply/demand pricing: scarce goods cost more, surplus costs less
- Visual indicators showing production flow (animated dots along roads)

### Citizen AI
- Each citizen is a simulated agent with: home, workplace, happiness, health, skill
- Citizens pathfind (A* algorithm) along roads between home and work
- Visible as small animated dots walking along roads
- Citizens consume food and goods; if unavailable, happiness drops
- Unhappy citizens leave the city (population decreases)
- New citizens arrive when happiness is high and housing is available
- Population counter and happiness meter on HUD

### Economy
- Tax revenue from market sales funds new construction
- Building costs: each building type has a construction cost
- Maintenance costs: buildings drain treasury each cycle
- Budget screen showing income, expenses, treasury balance
- Interest on debt if treasury goes negative
- Difficulty scaling: costs increase with city size

### Day/Night Cycle
- Full day/night cycle over ~3 real minutes
- Gradual color temperature shift (warm daylight → orange sunset → blue night → pink dawn)
- Buildings light up windows at night (yellow/warm white dots)
- Streetlights along roads activate at night
- Farms only produce during daytime
- Crime rate increases at night if no streetlights

### Weather System
- Weather changes every 30-60 seconds
- **Clear** — Normal production, high happiness
- **Rain** — Farm output +50%, citizen happiness -10%, visual rain particles
- **Storm** — Farm output -50%, chance of lightning striking buildings (minor damage), strong rain + lightning flash effects
- **Snow** — All production -25%, roads slow movement, white overlay on terrain
- **Drought** — Farm output -75%, fires more likely, brown tint
- Weather forecast shown on HUD (next weather + countdown)

### Tech Tree
- Spend "research points" (generated by schools) to unlock upgrades
- Tree with 3 branches:
  - **Industry**: Factory efficiency → Automation → Mass Production
  - **Society**: Education boost → Healthcare → Entertainment (unlocks Stadium building)
  - **Green**: Solar power → Recycling (reduces pollution) → Terraforming (reshape terrain)
- Simple visual tech tree panel the player can open

### Natural Disasters (Matter.js from CDN for physics)
- **Earthquake**: Every 3-5 minutes, chance of earthquake. Screen shakes, some buildings take damage (cracks appear), weakened buildings collapse with physics (Matter.js rigid body chunks falling).
- **Fire**: Spreads between adjacent buildings if no fire station. Visual fire particles, buildings char and eventually collapse.
- Repair crews automatically dispatch to damaged buildings (costs money)
- Disaster notification with location marker on minimap

### Save/Load
- Auto-save to localStorage every 60 seconds
- Manual save/load buttons
- Save entire game state: terrain, buildings, citizens, economy, tech tree, time

### UI & HUD
- **Top bar**: Population, Treasury ($), Happiness (%), Date/Time
- **Bottom toolbar**: Building selection palette (icons for each building type)
- **Right panel** (toggleable): Selected building info, production stats
- **Budget panel** (B key): Income/expense breakdown
- **Tech tree panel** (T key): Research progress and unlocks
- Building placement preview (ghost building follows mouse, green if valid, red if invalid)
- Tooltip on hover showing building name, cost, production
- Speed controls: Pause (Space), 1x, 2x, 3x simulation speed

### Audio (Web Audio API)
- Ambient city sounds: low murmur that increases with population
- Construction sound when placing buildings (short percussive hit)
- Cash register "cha-ching" on market sales
- Weather sounds: rain patter, thunder cracks, wind
- Earthquake rumble (low-frequency oscillator with heavy vibrato)
- Simple background music: procedural ambient chords that shift with day/night

## Technical Constraints
- Single `index.html` file
- Matter.js loaded from CDN (for disaster physics only)
- Canvas 2D for all rendering
- Must handle 64x64 tile map with hundreds of citizens at 30+ fps
- Use efficient data structures (typed arrays for terrain, spatial grid for pathfinding)
- All graphics procedurally drawn (no image files)
- All audio synthesized via Web Audio API
- localStorage for save/load (JSON serialization of game state)
